{"id": "category-spend-analysis", "name": "Category Spending Analysis", "description": "Analyze spending by category with flexible aggregation", "tags": ["category", "spend", "aggregation"], "sql_hint": "Example: For category spending analysis, you can use flexible GROUP BY with category normalization:\nSELECT\n  COALESCE(ut.provider_tx_category_detailed, ut.category_detailed, ut.provider_tx_category, ut.category, 'Uncategorized') AS category,\n  SUM(CASE WHEN ut.amount < 0 THEN -ut.amount ELSE 0 END) AS total_spend,\n  COUNT(*) AS transaction_count\nFROM public.unified_transactions ut\nWHERE ut.user_id = '{user_id}'\n  AND ut.transaction_date >= CURRENT_DATE - INTERVAL '{days} days'\n  AND COALESCE(ut.pending,false)=false\n  AND COALESCE(ut.is_cancelled,false)=false\n  AND COALESCE(ut.is_payment,false)=false\nGROUP BY category\nORDER BY total_spend DESC", "examples": ["how much did I spend by category", "category breakdown of expenses", "spending analysis by category"], "version": "1.0", "deprecated": false}
{"id": "cash-flow-6m", "name": "Cash Flow (Last 6 Months)", "description": "Monthly income, spending, and net cash flow for the last 6 months.", "tags": ["cash_flow", "trend", "6m"], "sql_hint": "WITH months AS (\n  SELECT date_trunc('month', d)::date AS month\n  FROM generate_series(\n    date_trunc('month', CURRENT_DATE) - INTERVAL '5 months',\n    date_trunc('month', CURRENT_DATE),\n    INTERVAL '1 month'\n  ) d\n),\nagg AS (\n  SELECT\n    date_trunc('month', ut.transaction_date)::date AS month,\n    SUM(CASE WHEN ut.amount > 0 THEN ut.amount ELSE 0 END) AS income,\n    SUM(CASE WHEN ut.amount < 0 THEN -ut.amount ELSE 0 END) AS spend\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= (date_trunc('month', CURRENT_DATE) - INTERVAL '5 months')\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n  GROUP BY 1\n)\nSELECT m.month, COALESCE(a.income,0) AS monthly_income, COALESCE(a.spend,0) AS monthly_spend,\n       COALESCE(a.income,0) - COALESCE(a.spend,0) AS net_cash_flow\nFROM months m\nLEFT JOIN agg a ON a.month = m.month\nORDER BY m.month", "examples": ["cash flow last 6 months", "income and spending trend last six months", "net cash flow recent months"], "version": "1.0", "deprecated": false}
{"id": "upcoming-liability-payments", "name": "Upcoming Liability Payments (Next 45 Days)", "description": "List active liabilities with a due date in the next 45 days and their minimum payments.", "tags": ["liability", "payments", "upcoming"], "sql_hint": "SELECT\n  l.name,\n  l.category,\n  l.minimum_payment_amount,\n  l.next_payment_due_date\nFROM public.unified_liabilities l\nWHERE l.user_id = '{user_id}'\n  AND COALESCE(l.is_active,true)=true\n  AND l.next_payment_due_date IS NOT NULL\n  AND l.next_payment_due_date BETWEEN CURRENT_DATE AND (CURRENT_DATE + INTERVAL '45 days')\nORDER BY l.next_payment_due_date ASC", "examples": ["what bills are due soon", "upcoming liability payments", "minimum payments due next month"], "version": "1.0", "deprecated": false}
{"id": "top-recurring-expenses-6m", "name": "Top Recurring Expenses (Last 6 Months)", "description": "Rank recurring merchants by total spend over the last 6 months.", "tags": ["recurring", "merchant", "top"], "sql_hint": "WITH base AS (\n  SELECT\n    COALESCE(NULLIF(ut.merchant_name,''), NULLIF(ut.name,'')) AS merchant,\n    -ut.amount AS spend\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= (date_trunc('month', current_date) - INTERVAL '5 months')\n    AND ut.amount < 0\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n    AND COALESCE(ut.is_recurring,false)=true\n)\nSELECT merchant, SUM(spend) AS total_recurring_spend, COUNT(*) AS tx_count\nFROM base\nWHERE merchant IS NOT NULL\nGROUP BY merchant\nORDER BY total_recurring_spend DESC\nLIMIT 10", "examples": ["top recurring expenses", "largest recurring merchants", "recurring subscriptions"], "version": "1.0", "deprecated": false}
{"id": "asset-allocation-by-category", "name": "Asset Allocation by Category", "description": "Sum active asset values grouped by category.", "tags": ["assets", "allocation", "category"], "sql_hint": "SELECT\n  ua.category,\n  SUM(ua.estimated_value) AS total_value\nFROM public.unified_assets ua\nWHERE ua.user_id = '{user_id}'\n  AND COALESCE(ua.is_active,true)=true\nGROUP BY ua.category\nORDER BY total_value DESC", "examples": ["asset allocation", "assets by category", "asset mix"], "version": "1.0", "deprecated": false}
{"id": "emergency-mean-median-6m", "name": "Emergency Fund (Mean and Median, Last 6 Months)", "description": "Compute both mean and median monthly spend to recommend 3–6 month emergency fund.", "tags": ["emergency", "median", "mean"], "sql_hint": "WITH m AS (\n  SELECT date_trunc('month', ut.transaction_date) AS month,\n         SUM(CASE WHEN ut.amount < 0 THEN -ut.amount ELSE 0 END) AS monthly_spend\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= (date_trunc('month', current_date) - INTERVAL '5 months')\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n  GROUP BY 1\n)\nSELECT\n  COALESCE(AVG(monthly_spend),0) AS avg_monthly_spend_6m,\n  percentile_cont(0.5) WITHIN GROUP (ORDER BY monthly_spend) AS median_monthly_spend_6m,\n  COALESCE(AVG(monthly_spend),0) * 3 AS recommended_low_mean,\n  COALESCE(AVG(monthly_spend),0) * 6 AS recommended_high_mean,\n  percentile_cont(0.5) WITHIN GROUP (ORDER BY monthly_spend) * 3 AS recommended_low_median,\n  percentile_cont(0.5) WITHIN GROUP (ORDER BY monthly_spend) * 6 AS recommended_high_median\nFROM m", "examples": ["emergency fund mean vs median", "median monthly spend last 6 months", "emergency savings robust"], "version": "1.0", "deprecated": false}
{"id": "financial-health-metrics", "name": "Comprehensive Financial Health Metrics", "description": "Compute key metrics: net worth, recent income/spend, savings rate, and DTI using active assets, liabilities, and recent transactions.", "tags": ["health", "score", "net_worth", "dti", "savings_rate"], "sql_hint": "WITH income_30d AS (\n  SELECT COALESCE(SUM(ut.amount), 0) AS income_30d\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= CURRENT_DATE - INTERVAL '30 days'\n    AND ut.amount > 0\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n),\nspend_30d AS (\n  SELECT COALESCE(SUM(-ut.amount), 0) AS spend_30d\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= CURRENT_DATE - INTERVAL '30 days'\n    AND ut.amount < 0\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n),\nmin_pay AS (\n  SELECT COALESCE(SUM(ul.minimum_payment_amount), 0) AS monthly_debt_payments\n  FROM public.unified_liabilities ul\n  WHERE ul.user_id = '{user_id}' AND COALESCE(ul.is_active, true) = true\n),\nassets_val AS (\n  SELECT COALESCE(SUM(ua.estimated_value), 0) AS total_assets\n  FROM public.unified_assets ua\n  WHERE ua.user_id = '{user_id}' AND COALESCE(ua.is_active, true) = true\n),\nliabs_principal AS (\n  SELECT COALESCE(SUM(ul.principal_balance), 0) AS total_liabilities_principal\n  FROM public.unified_liabilities ul\n  WHERE ul.user_id = '{user_id}' AND COALESCE(ul.is_active, true) = true\n)\nSELECT\n  a.total_assets,\n  l.total_liabilities_principal,\n  a.total_assets - l.total_liabilities_principal AS net_worth,\n  i.income_30d,\n  s.spend_30d,\n  CASE WHEN i.income_30d > 0 THEN 1 - (s.spend_30d / i.income_30d) ELSE NULL END AS savings_rate_30d,\n  m.monthly_debt_payments AS monthly_debt_payments,\n  CASE WHEN i.income_30d > 0 THEN m.monthly_debt_payments / i.income_30d ELSE NULL END AS dti_min_payment\nFROM assets_val a, liabs_principal l, income_30d i, spend_30d s, min_pay m", "examples": ["what's my financial health score", "what's my overall financial health", "show net worth, recent savings rate, and debt-to-income"], "version": "1.0", "deprecated": false}
{"id": "spending-trends-ytd", "name": "Spending and Income Trends (Year-to-Date)", "description": "Monthly spending and income trends for the current year (fills missing months; one query, no pre-checks).", "tags": ["trend", "ytd", "timeseries", "monthly"], "sql_hint": "WITH months AS (\n  SELECT date_trunc('month', d)::date AS month\n  FROM generate_series(\n    date_trunc('year', current_date)::date,\n    date_trunc('year', current_date)::date + interval '11 months',\n    interval '1 month'\n  ) d\n),\nagg AS (\n  SELECT\n    date_trunc('month', ut.transaction_date)::date AS month,\n    SUM(CASE WHEN ut.amount < 0 THEN -ut.amount ELSE 0 END) AS monthly_spend,\n    SUM(CASE WHEN ut.amount > 0 THEN ut.amount ELSE 0 END) AS monthly_income\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= date_trunc('year', current_date)\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n  GROUP BY 1\n)\nSELECT m.month, COALESCE(a.monthly_spend,0) AS monthly_spend, COALESCE(a.monthly_income,0) AS monthly_income\nFROM months m LEFT JOIN agg a ON a.month = m.month\nORDER BY m.month ASC", "examples": ["how are my spending trends this year", "spending and income by month this year", "year to date spending trend"], "version": "1.1", "deprecated": false}
{"id": "merchant-spend-12m-minimal", "name": "Merchant Spend (12M, One-Shot Minimal)", "description": "Compute total spend at a merchant over the past 12 months in a single statement (no pre-checks).", "tags": ["merchant", "spend", "12m", "one_shot"], "sql_hint": "SELECT\n  COALESCE(SUM(CASE WHEN amount < 0 THEN -amount ELSE 0 END), 0) AS total_spent\nFROM public.unified_transactions\nWHERE user_id = '{user_id}'\n  AND transaction_date >= CURRENT_DATE - INTERVAL '12 months'\n  AND (LOWER(COALESCE(merchant_name, name)) LIKE '%mcdonald%')\n  AND COALESCE(pending,false)=false\n  AND COALESCE(is_cancelled,false)=false\n  AND COALESCE(is_payment,false)=false", "examples": ["how much did I spend at McDonald's in the last year", "merchant spend last 12 months"], "version": "1.0", "deprecated": false}
{"id": "merchant-spend-12m-full-if-asked", "name": "Merchant Spend (12M, Full Metrics If Asked)", "description": "Return total, count, avg, first and last txn in one query (only use if user asks for details).", "tags": ["merchant", "spend", "12m", "full"], "sql_hint": "SELECT\n  COALESCE(SUM(CASE WHEN amount < 0 THEN -amount ELSE 0 END), 0) AS total_spent,\n  COUNT(*) AS txn_count,\n  CASE WHEN COUNT(*)>0 THEN COALESCE(SUM(CASE WHEN amount < 0 THEN -amount ELSE 0 END),0)::numeric / COUNT(*) ELSE 0 END AS avg_spend,\n  MIN(transaction_date) AS first_txn,\n  MAX(transaction_date) AS last_txn\nFROM public.unified_transactions\nWHERE user_id = '{user_id}'\n  AND transaction_date >= CURRENT_DATE - INTERVAL '12 months'\n  AND (LOWER(COALESCE(merchant_name, name)) LIKE '%mcdonald%')\n  AND COALESCE(pending,false)=false\n  AND COALESCE(is_cancelled,false)=false\n  AND COALESCE(is_payment,false)=false", "examples": ["break down spend at McDonald's (count and average)", "merchant spend details"], "version": "1.0", "deprecated": false}
{"id": "discretionary-vs-essential-30d", "name": "Discretionary vs Essential Spend (30D)", "description": "Split last 30 days spend into essential vs discretionary using category heuristics.", "tags": ["budget", "classification", "30d"], "sql_hint": "WITH base AS (\n  SELECT\n    CASE\n      WHEN provider_tx_category IN ('RENT_AND_UTILITIES','MORTGAGE','HOME_IMPROVEMENT','HOME_INSURANCE','GROCERIES','TRANSPORTATION','INSURANCE','HEALTHCARE') THEN 'essential'\n      ELSE 'discretionary'\n    END AS bucket,\n    CASE WHEN amount < 0 THEN -amount ELSE 0 END AS spend\n  FROM public.unified_transactions\n  WHERE user_id = '{user_id}'\n    AND transaction_date >= CURRENT_DATE - INTERVAL '30 days'\n    AND COALESCE(pending,false)=false\n    AND COALESCE(is_cancelled,false)=false\n    AND COALESCE(is_payment,false)=false\n)\nSELECT bucket, SUM(spend) AS total_spend\nFROM base\nGROUP BY bucket\nORDER BY total_spend DESC", "examples": ["discretionary vs essential spend last 30 days", "how much of my spending is essential"], "version": "1.0", "deprecated": false}
{"id": "income-volatility-6m", "name": "Income Volatility (6M)", "description": "Compute monthly income over last 6 months, with mean and coefficient of variation.", "tags": ["income", "volatility", "6m"], "sql_hint": "WITH months AS (\n  SELECT date_trunc('month', d)::date AS month\n  FROM generate_series(\n    date_trunc('month', current_date) - interval '5 months',\n    date_trunc('month', current_date),\n    interval '1 month'\n  ) d\n),\nagg AS (\n  SELECT date_trunc('month', ut.transaction_date)::date AS month,\n         SUM(CASE WHEN ut.amount > 0 THEN ut.amount ELSE 0 END) AS monthly_income\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= (date_trunc('month', current_date) - interval '5 months')\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n  GROUP BY 1\n),\nseries AS (\n  SELECT m.month, COALESCE(a.monthly_income,0)::numeric AS monthly_income\n  FROM months m LEFT JOIN agg a ON a.month = m.month\n)\nSELECT\n  AVG(monthly_income) AS avg_income_6m,\n  CASE WHEN STDDEV_POP(monthly_income) IS NOT NULL AND AVG(monthly_income) > 0\n       THEN STDDEV_POP(monthly_income) / AVG(monthly_income)\n       ELSE NULL END AS income_cv_6m\nFROM series", "examples": ["how volatile is my income", "income stability last 6 months"], "version": "1.0", "deprecated": false}
{"id": "largest-month-spend-ytd", "name": "Largest Month of Spending (YTD)", "description": "Identify the highest-spend month in the current year.", "tags": ["peak", "ytd", "spend"], "sql_hint": "WITH monthly AS (\n  SELECT date_trunc('month', ut.transaction_date)::date AS month,\n         SUM(CASE WHEN ut.amount < 0 THEN -ut.amount ELSE 0 END) AS monthly_spend\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= date_trunc('year', current_date)\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n  GROUP BY 1\n)\nSELECT month, monthly_spend\nFROM monthly\nORDER BY monthly_spend DESC\nLIMIT 1", "examples": ["what was my most expensive month this year"], "version": "1.0", "deprecated": false}
{"id": "weekday-vs-weekend-spend-90d", "name": "Weekday vs Weekend Spend (90D)", "description": "Compare spending on weekdays vs weekends (last 90 days).", "tags": ["behavior", "weekday", "weekend", "90d"], "sql_hint": "WITH base AS (\n  SELECT\n    CASE WHEN EXTRACT(ISODOW FROM transaction_date) IN (6,7) THEN 'weekend' ELSE 'weekday' END AS day_type,\n    CASE WHEN amount < 0 THEN -amount ELSE 0 END AS spend\n  FROM public.unified_transactions\n  WHERE user_id = '{user_id}'\n    AND transaction_date >= CURRENT_DATE - INTERVAL '90 days'\n    AND COALESCE(pending,false)=false\n    AND COALESCE(is_cancelled,false)=false\n    AND COALESCE(is_payment,false)=false\n)\nSELECT day_type, SUM(spend) AS total_spend\nFROM base\nGROUP BY day_type\nORDER BY total_spend DESC", "examples": ["do I spend more on weekends or weekdays"], "version": "1.0", "deprecated": false}
{"id": "housing-spend-share", "name": "Housing Spend Share (Last 90 Days)", "description": "Compute housing spend share vs total spend using provider and display categories.", "tags": ["housing", "budget", "category", "share"], "sql_hint": "WITH totals AS (\n  SELECT COALESCE(SUM(-ut.amount), 0) AS total_spend\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= CURRENT_DATE - INTERVAL '90 days'\n    AND ut.amount < 0\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n),\nhousing AS (\n  SELECT COALESCE(SUM(-ut.amount), 0) AS housing_spend\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= CURRENT_DATE - INTERVAL '90 days'\n    AND ut.amount < 0\n    AND COALESCE(ut.pending,false)=false\n    AND COALESCE(ut.is_cancelled,false)=false\n    AND COALESCE(ut.is_payment,false)=false\n    AND (\n      ut.provider_tx_category IN ('RENT_AND_UTILITIES','MORTGAGE','HOME_IMPROVEMENT','HOME_INSURANCE')\n      OR ut.category ILIKE 'HOUSING%'\n      OR ut.category ILIKE 'RENT%'\n      OR ut.category ILIKE 'MORTGAGE%'\n      OR ut.category ILIKE 'UTILIT%'\n      OR ut.category_detailed ILIKE 'HOUSING%'\n      OR ut.category_detailed ILIKE 'RENT%'\n      OR ut.category_detailed ILIKE 'MORTGAGE%'\n      OR ut.category_detailed ILIKE 'UTILIT%'\n    )\n)\nSELECT h.housing_spend, t.total_spend,\n       CASE WHEN t.total_spend > 0 THEN h.housing_spend / t.total_spend ELSE NULL END AS housing_spend_share\nFROM housing h, totals t", "examples": ["am i spending too much on housing", "housing spend share", "how much of my spend is housing"], "version": "1.0", "deprecated": false}
{"id": "debt-to-income-ratio", "name": "Debt-to-Income Ratio (Minimum Payments)", "description": "Monthly minimum debt payments divided by recent monthly income.", "tags": ["dti", "debt", "income"], "sql_hint": "WITH income_30d AS (\n  SELECT COALESCE(SUM(ut.amount), 0) AS income_30d\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= CURRENT_DATE - INTERVAL '30 days'\n    AND ut.amount > 0\n),\nmin_pay AS (\n  SELECT COALESCE(SUM(ul.minimum_payment_amount), 0) AS monthly_debt_payments\n  FROM public.unified_liabilities ul\n  WHERE ul.user_id = '{user_id}' AND COALESCE(ul.is_active, true) = true\n)\nSELECT m.monthly_debt_payments, i.income_30d,\n       CASE WHEN i.income_30d > 0 THEN m.monthly_debt_payments / i.income_30d ELSE NULL END AS dti\nFROM min_pay m, income_30d i", "examples": ["what's my debt-to-income ratio", "calculate my dti", "debt to income"], "version": "1.0", "deprecated": false}
{"id": "emergency-savings-recommendation", "name": "Emergency Savings Recommendation (3–6 months)", "description": "Compute average monthly spend and derive recommended 3–6 months emergency fund.", "tags": ["emergency", "savings", "budget"], "sql_hint": "WITH monthly AS (\n  SELECT DATE_TRUNC('month', ut.transaction_date) AS month,\n         SUM(CASE WHEN ut.amount < 0 THEN -ut.amount ELSE 0 END) AS monthly_spend\n  FROM public.unified_transactions ut\n  WHERE ut.user_id = '{user_id}'\n    AND ut.transaction_date >= (DATE_TRUNC('month', CURRENT_DATE) - INTERVAL '5 months')\n  GROUP BY 1\n),\navg_spend AS (\n  SELECT COALESCE(AVG(monthly_spend), 0) AS avg_monthly_spend_6m FROM monthly\n)\nSELECT a.avg_monthly_spend_6m,\n       a.avg_monthly_spend_6m * 3 AS recommended_low,\n       a.avg_monthly_spend_6m * 6 AS recommended_high\nFROM avg_spend a", "examples": ["how much should i have in emergency savings", "emergency fund recommendation", "emergency savings target"], "version": "1.0", "deprecated": false}
{"id": "net-worth-snapshot", "name": "Net Worth Snapshot", "description": "Compute net worth from active assets minus active liabilities principal.", "tags": ["net_worth", "assets", "liabilities"], "sql_hint": "WITH assets_val AS (\n  SELECT COALESCE(SUM(ua.estimated_value), 0) AS total_assets\n  FROM public.unified_assets ua\n  WHERE ua.user_id = '{user_id}' AND COALESCE(ua.is_active, true) = true\n),\nliabs_principal AS (\n  SELECT COALESCE(SUM(ul.principal_balance), 0) AS total_liabilities_principal\n  FROM public.unified_liabilities ul\n  WHERE ul.user_id = '{user_id}' AND COALESCE(ul.is_active, true) = true\n)\nSELECT a.total_assets, l.total_liabilities_principal,\n       a.total_assets - l.total_liabilities_principal AS net_worth\nFROM assets_val a, liabs_principal l", "examples": ["what's my net worth", "net worth snapshot", "assets minus liabilities"], "version": "1.0", "deprecated": false}
{"id": "time-series-spend", "name": "Time Series Spending Analysis", "description": "Track spending trends over time periods", "tags": ["timeseries", "trend", "daily"], "sql_hint": "Example: For time-based analysis, normalize dates and use flexible date ranges:\nSELECT\n  DATE_TRUNC('day', COALESCE(t.transaction_date, t.authorized_date)) AS spend_date,\n  SUM(CASE WHEN t.amount > 0 THEN t.amount ELSE 0 END) AS daily_spend,\n  COUNT(*) AS transaction_count\nFROM {transactions} t\nWHERE t.user_id = '{user_id}'\n  AND DATE_TRUNC('day', COALESCE(t.transaction_date, t.authorized_date)) >= CURRENT_DATE - INTERVAL '{days} days'\nGROUP BY spend_date\nORDER BY spend_date ASC", "examples": ["daily spending over time", "spend trend last month", "how much did I spend each day"], "version": "1.0", "deprecated": false}
{"id": "merchant-analysis", "name": "Merchant Spending Analysis", "description": "Analyze spending patterns by merchant", "tags": ["merchant", "vendor", "top-n"], "sql_hint": "Example: For merchant analysis, normalize merchant names and use flexible ranking:\nWITH merchant_summary AS (\n  SELECT\n    COALESCE(NULLIF(t.merchant_name, ''), NULLIF(t.name, '')) AS merchant,\n    SUM(CASE WHEN t.amount > 0 THEN t.amount ELSE 0 END) AS total_spend,\n    COUNT(*) AS transaction_count,\n    AVG(CASE WHEN t.amount > 0 THEN t.amount ELSE NULL END) AS avg_transaction\n  FROM {transactions} t\n  WHERE t.user_id = '{user_id}'\n    AND t.tx_date >= CURRENT_DATE - INTERVAL '{days} days'\n  GROUP BY merchant\n)\nSELECT * FROM merchant_summary\nWHERE merchant IS NOT NULL\nORDER BY total_spend DESC\nLIMIT {top_k}", "examples": ["where do I spend the most", "top merchants by spending", "merchant analysis"], "version": "1.0", "deprecated": false}
{"id": "date-range-analysis", "name": "Flexible Date Range Analysis", "description": "Handle various date range patterns flexibly", "tags": ["date", "range", "period"], "sql_hint": "Example: For flexible date handling, use normalized dates with multiple strategies:\n-- Last N days\nWHERE COALESCE(t.transaction_date, t.authorized_date) >= CURRENT_DATE - INTERVAL '{days} days'\n\n-- Specific date range\nWHERE COALESCE(t.transaction_date, t.authorized_date) BETWEEN '{start_date}' AND '{end_date}'\n\n-- Month-based\nWHERE DATE_TRUNC('month', COALESCE(t.transaction_date, t.authorized_date)) = DATE_TRUNC('month', CURRENT_DATE)\n\n-- Year-to-date\nWHERE EXTRACT(YEAR FROM COALESCE(t.transaction_date, t.authorized_date)) = EXTRACT(YEAR FROM CURRENT_DATE)", "examples": ["last month spending", "this year expenses", "spending in January"], "version": "1.0", "deprecated": false}
